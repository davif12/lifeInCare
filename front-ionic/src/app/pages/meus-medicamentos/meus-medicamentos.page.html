<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <ion-icon name="medical-outline"></ion-icon>
      Meus Medicamentos
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="doRefresh($event)">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div *ngIf="loading" class="loading-container">
    <ion-spinner></ion-spinner>
    <p>Carregando medicamentos...</p>
  </div>

  <div *ngIf="!loading && medications.length === 0" class="elderly-empty-state elderly-animate-fadeIn">
    <ion-icon name="medical-outline" size="large"></ion-icon>
    <h2>Nenhum medicamento encontrado</h2>
    <p>Seu cuidador ainda não cadastrou medicamentos para você.</p>
    <ion-button fill="outline" color="primary" (click)="loadMyMedications()" class="elderly-btn elderly-btn-primary elderly-accessible">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      Atualizar
    </ion-button>
    <ion-button fill="outline" color="secondary" (click)="testDatabaseConnection()" class="elderly-btn elderly-btn-secondary elderly-accessible">
      <ion-icon name="bug-outline" slot="start"></ion-icon>
      Testar Conexão
    </ion-button>
  </div>

  <ion-list *ngIf="!loading && medications.length > 0" class="elderly-animate-fadeIn">
    <ion-card *ngFor="let medication of medications; let i = index" class="elderly-card elderly-animate-slideIn" [style.animation-delay]="(i * 0.1) + 's'">
      <div class="elderly-card-header">
        <div class="medication-header">
          <h3 class="title elderly-text-lg elderly-text-semibold">{{ medication.name }}</h3>
          <ion-chip [color]="getStatusColor(medication.isActive)" class="elderly-animate-pulse">
            <ion-label class="elderly-text-sm elderly-text-medium">{{ getStatusText(medication.isActive) }}</ion-label>
          </ion-chip>
        </div>
        <p class="subtitle elderly-text-md elderly-text-secondary">{{ medication.dosage }}</p>
      </div>

      <ion-card-content>
        <div class="medication-info">
          <div class="info-item">
            <ion-icon name="time-outline" color="primary"></ion-icon>
            <div>
              <strong>Próxima dose:</strong>
              <p class="next-dose">{{ getNextDose(medication.schedules) }}</p>
            </div>
          </div>

          <div class="info-item">
            <ion-icon name="notifications-outline" color="primary"></ion-icon>
            <div>
              <strong>Horários:</strong>
              <p>{{ formatSchedules(medication.schedules) }}</p>
            </div>
          </div>

          <div class="info-item">
            <ion-icon name="calendar-outline" color="primary"></ion-icon>
            <div>
              <strong>Início:</strong>
              <p>{{ formatDate(medication.startDate) }}</p>
            </div>
          </div>

          <div class="info-item" *ngIf="medication.endDate">
            <ion-icon name="calendar-outline" color="medium"></ion-icon>
            <div>
              <strong>Fim:</strong>
              <p>{{ formatDate(medication.endDate) }}</p>
            </div>
          </div>

          <div class="info-item" *ngIf="medication.instructions">
            <ion-icon name="information-circle-outline" color="primary"></ion-icon>
            <div>
              <strong>Instruções:</strong>
              <p>{{ medication.instructions }}</p>
            </div>
          </div>
        </div>

        <!-- Botões de Ação -->
        <div class="action-buttons">
          <ion-button 
            *ngIf="medication.isActive"
            fill="solid" 
            color="success" 
            size="small"
            (click)="markAsTaken(medication)">
            <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
            Marcar como Tomado
          </ion-button>
          
          <ion-button 
            fill="outline" 
            color="primary" 
            size="small"
            (click)="showMedicationDetails(medication)">
            <ion-icon name="information-circle-outline" slot="start"></ion-icon>
            Detalhes
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </ion-list>
</ion-content>
