<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home-cuidador" icon="arrow-back-outline"></ion-back-button>
    </ion-buttons>
    <ion-title>Cadastrar Idoso</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form (ngSubmit)="onSubmit()">
    <ion-list>
      <ion-item>
        <ion-label position="stacked">
          <ion-icon name="person-outline"></ion-icon>
          Nome completo *
        </ion-label>
        <ion-input type="text" [(ngModel)]="elderly.name" name="name" required></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">
          <ion-icon name="calendar-outline"></ion-icon>
          Data de Nascimento *
        </ion-label>
        <ion-input 
          type="date" 
          [(ngModel)]="elderly.birthDate" 
          name="birthDate" 
          [max]="maxDate"
          required>
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">
          <ion-icon name="medical-outline"></ion-icon>
          Informações médicas relevantes
        </ion-label>
        <ion-textarea 
          [(ngModel)]="elderly.medicalInfo" 
          name="medicalInfo"
          placeholder="Doenças, alergias, medicações, etc."
          rows="3">
        </ion-textarea>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">
          <ion-icon name="call-outline"></ion-icon>
          Informações de contato
        </ion-label>
        <ion-textarea 
          [(ngModel)]="elderly.contactInfo" 
          name="contactInfo"
          placeholder="Telefones para emergência, endereço, etc."
          rows="3">
        </ion-textarea>
      </ion-item>
    </ion-list>

    <div class="ion-padding-top">
      <ion-button expand="block" type="submit" [disabled]="isSubmitting">
        Cadastrar Idoso
      </ion-button>
    </div>

    <div *ngIf="errorMessage" class="error-message ion-padding-top">
      <ion-note color="danger">{{ errorMessage }}</ion-note>
    </div>
  </form>
</ion-content>

<!-- Modal para exibir o PIN após o cadastro -->
<ion-modal [isOpen]="showSuccessToast">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Cadastro Realizado!</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="showSuccessToast = false">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding ion-text-center">
      <h2>Idoso cadastrado com sucesso!</h2>
      <p>Forneça o PIN abaixo para que o idoso possa acessar o aplicativo:</p>
      <div class="pin-display">
        <h1>{{ registeredPin }}</h1>
      </div>
      <p class="ion-padding-top"><strong>Importante:</strong> Anote esse PIN, pois ele será necessário para acessar a conta do idoso.</p>
      
      <div class="ion-padding-top">
        <ion-button expand="block" (click)="showSuccessToast = false">
          OK, Entendi
        </ion-button>
        <ion-button expand="block" fill="outline" class="ion-margin-top" (click)="navigateToElderlyList()">
          Ver Lista de Idosos
        </ion-button>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
