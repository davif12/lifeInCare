<ion-header>
  <ion-toolbar>
    <ion-title>Olá, {{nome}}!</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="sair()">
        <ion-icon slot="icon-only" name="exit-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="dashboard">
    <!-- Resumo de Medicamentos -->
    <div *ngIf="medicationSummary" class="summary-section elderly-animate-fadeIn">
      <h2 class="elderly-text-xl elderly-text-bold">Resumo dos seus medicamentos</h2>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <ion-card class="summary-card elderly-animate-slideIn elderly-animate-delay-1">
              <ion-card-content class="ion-text-center">
                <h3>{{medicationSummary.activeMedications}}</h3>
                <p>Medicamentos Ativos</p>
              </ion-card-content>
            </ion-card>
          </ion-col>
          <ion-col size="6">
            <ion-card class="summary-card elderly-animate-slideIn elderly-animate-delay-2">
              <ion-card-content class="ion-text-center">
                <h3>{{medicationSummary.todayDoses}}</h3>
                <p>Doses Hoje</p>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <!-- Próxima Dose em Destaque -->
    <div *ngIf="medicationSummary?.nextDose" class="next-dose-section elderly-animate-fadeIn elderly-animate-delay-2">
      <ion-card class="next-dose-card" [ngClass]="getNextDoseUrgencyClass()">
        <ion-card-content>
          <h3>Próxima dose</h3>
          <p><strong>{{medicationSummary?.nextDose?.medicationName}}</strong></p>
          <p>{{medicationSummary?.nextDose?.dosage}} às {{medicationSummary?.nextDose?.time}}</p>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Timeline Unificada -->
    <div class="unified-timeline-section">
      <h2 class="elderly-text-xl elderly-text-bold">Sua agenda de hoje</h2>
      
      <!-- Estado de carregamento -->
      <div *ngIf="loading" class="elderly-loading">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Carregando sua agenda...</p>
      </div>
      
      <!-- Timeline Integrada -->
      <div *ngIf="!loading" class="timeline-container">
        <ion-card *ngFor="let item of timelineItems; let i = index" 
                  class="elderly-card timeline-item elderly-animate-slideIn" 
                  [style.animation-delay]="(i * 0.1) + 's'"
                  [ngClass]="getTimelineItemClass(item)">
          
          <div class="timeline-marker" [ngClass]="item.type">
            <ion-icon [name]="getTimelineIcon(item.type)"></ion-icon>
          </div>
          
          <div class="elderly-card-content">
            <div class="timeline-header">
              <h3 class="elderly-text-lg elderly-text-semibold">{{item.title}}</h3>
              <ion-chip [color]="getUrgencyColor(item)" size="small">
                {{getTypeLabel(item.type)}}
              </ion-chip>
            </div>
            
            <p class="elderly-text-md elderly-text-secondary">{{item.description}}</p>
            
            <div class="timeline-time">
              <ion-icon name="time-outline" color="primary"></ion-icon>
              <span class="elderly-text-lg elderly-text-primary">{{item.time}}</span>
            </div>
            
            <ion-button *ngIf="item.actionable" 
                       fill="clear" 
                       size="small"
                       [disabled]="item.completed"
                       (click)="markTimelineItemCompleted(item)"
                       class="timeline-action">
              <ion-icon 
                [name]="item.completed ? 'checkmark-circle' : 'checkmark-circle-outline'" 
                slot="start"
                [color]="item.completed ? 'success' : 'primary'">
              </ion-icon>
              {{item.completed ? 'Concluído' : 'Marcar como feito'}}
            </ion-button>
          </div>
        </ion-card>
        
        <!-- Estado vazio -->
        <div *ngIf="timelineItems.length === 0" class="elderly-empty-state">
          <ion-icon name="calendar-clear-outline" size="large"></ion-icon>
          <h2>Agenda livre hoje!</h2>
          <p>Você não tem medicamentos, lembretes ou consultas agendados para hoje.</p>
        </div>
      </div>
    </div>
    
    <h2 class="elderly-text-xl elderly-text-bold">Acesso rápido</h2>
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-card routerLink="/meus-medicamentos" class="menu-card elderly-animate-fadeIn elderly-animate-delay-3 elderly-accessible">
            <ion-card-content class="ion-text-center">
              <ion-icon name="medical-outline"></ion-icon>
              <p>Meus Medicamentos</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card class="menu-card elderly-animate-fadeIn elderly-animate-delay-4 elderly-accessible" routerLink="/my-consultations">
            <ion-card-content class="ion-text-center">
              <ion-icon name="calendar-outline"></ion-icon>
              <p>Consultas</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>
